<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Versi riflessi</title>
    <meta name="description" content="poesie scritte per qualcuno in cerca di qualcosa da qualche parte">
    
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAPgAAAAF+oABWcAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREREREiEREREREREREhEREhERERERIRIiERERERESIiIhERERERIAACIRERERIgAiIhEREREiAgAAIREREiICACIhEREREiICAAIRERERIgIAIhERERERIgICERERERERIiIREREREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#a0522d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="icon-192.png">

    <style>
        /* ======================================== */
        /* THEME & BASE STYLES                      */
        /* ======================================== */
        /* @font-face {
            font-family: 'Neuton';
            src: url('Neuton/Neuton-Regular-subset.woff2') format('woff2'),
                url('Neuton/Neuton-Regular-subset.zopfli.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        } */
        :root {
            --bg-color: #fdf6e3;
            --text-color: #333333;
            --heading-color: #5d4037;
            --accent-color: #a0522d;
            --border-color: #e0d9c6;
            --panel-bg: rgba(255, 255, 255, 0.5);
        }

        html.dark-mode {
            --bg-color: #1e1e1e;
            --text-color: #dcdcdc;
            --heading-color: #e0e0e0;
            --accent-color: #d4af37;
            --border-color: #444444;
            --panel-bg: rgba(40, 40, 40, 0.5);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Charter', 'Georgia', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            font-size: 17px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1, h2, h3 {
            font-family: 'Charter', 'Times New Roman', serif;
            color: var(--heading-color);
            line-height: 1.3;
        }
        
        a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.2s;
        }
        a:hover {
            text-decoration: underline;
        }

        /* ======================================== */
        /* HEADER & NAVIGATION                      */
        /* ======================================== */
        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .logo {
            font-family: 'Charter', serif;
            font-size: 2rem;
            font-weight: 700;
            font-style: italic;
            color: var(--heading-color);
        }
        .logo:hover {
            text-decoration: none;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .theme-switcher {
            background: none; border: none; cursor: pointer; color: var(--text-color);
        }
        .theme-switcher svg { width: 22px; height: 22px; }
        .theme-switcher .moon-icon { display: none; }
        html.dark-mode .theme-switcher .moon-icon { display: block; }
        html.dark-mode .theme-switcher .sun-icon { display: none; }


        /* ======================================== */
        /* BOOK-STYLE LAYOUT                        */
        /* ======================================== */
        .book-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2.5rem;
            align-items: flex-start;
        }
        
        .left-panel {
            position: sticky;
            top: 2rem;
            border-right: 1px solid var(--border-color);
            padding-right: 2.5rem;
            /* height: calc(100vh - 4rem);
            overflow-y: auto; */
        }
        
        /* Mobile toggle button */
        .mobile-toggle {
            display: none;
            width: 100%;
            padding: 1rem;
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .mobile-toggle:hover {
            background-color: var(--heading-color);
        }
        
        html.dark-mode .mobile-toggle {
            color: #1e1e1e;
        }
        
        .mobile-toggle svg {
            width: 18px;
            height: 18px;
            margin-left: 0.5rem;
            transition: transform 0.3s;
        }
        
        .mobile-toggle.expanded svg {
            transform: rotate(180deg);
        }
        
        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            fill: var(--text-color);
            opacity: 0.4;
        }
        .search-box {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.7rem;
            font-size: 1rem;
            font-family: 'Charter', serif;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin-bottom: 1.5rem;
            margin-top: 1.5rem;
        }
        .search-box:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        #poems-toc {
            list-style: none;
        }

        #poems-toc li a {
            display: block;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            margin-bottom: 0.25rem;
            font-size: 1.05rem;
            color: var(--text-color);
        }

        #poems-toc li a:hover {
            background-color: var(--panel-bg);
            text-decoration: none;
        }
        
        #poems-toc li a.active {
            background-color: var(--accent-color);
            color: white;
            font-weight: 600;
        }
        html.dark-mode #poems-toc li a.active {
            color: #1e1e1e;
        }

        .content-viewer {
            padding: 1rem 0;
        }
        
        .content-viewer > section {
            display: none;
        }
        
        .content-viewer > section.active {
            display: block;
        }

        .poem-display h2 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .poem-meta {
            font-style: italic;
            color: #888;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .poem-text {
            font-size: 1.2rem;
            line-height: 1.5;
            max-width: 65ch;
        }
        
        .poem-commentary {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            max-width: 65ch;
            font-style: italic;
            background-color: var(--panel-bg);
            padding: 1.5rem;
            border-radius: 5px;
        }
        .poem-commentary h3 {
            font-style: normal;
            margin-bottom: 1rem;
        }
        /* ======================================== */
        /* POEM NOTES (SECRET)                      */
        /* ======================================== */
        .poem-notes {
            display: none; /* Nascosto di default */
            margin-top: 3rem;
            padding: 1.5rem;
            background-color: var(--panel-bg);
            border-left: 4px solid var(--accent-color);
            border-radius: 0 5px 5px 0;
            font-style: italic;
            font-size: 1rem;
            color: var(--text-color);
            animation: revealNote 0.6s cubic-bezier(0.22, 1, 0.36, 1);
        }

        .poem-notes.revealed {
            display: block;
        }

        /* Animazione di comparsa */
        @keyframes revealNote {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Impedisce la selezione del testo mentre si clicca velocemente sul titolo */
        .poem-display h2 {
            user-select: none;
            -webkit-user-select: none;
            cursor: pointer; /* Suggerisce che è interagibile, opzionale */
        }
        /* About Pages */
        .page-content {
            max-width: 70ch;
        }
        .page-content h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        .page-content p {
            margin-bottom: 1rem;
        }
        
        .site-footer {
            text-align: center;
            margin-top: 4rem;
            padding-top: 2rem;
            font-size: 0.9rem;
            color: #888;
            border-top: 1px solid var(--border-color);
        }
        
        @media (max-width: 900px) {
            .book-layout {
                grid-template-columns: 1fr;
            }
            .left-panel {
                position: static;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding-right: 0;
                margin-bottom: 2rem;
                padding-bottom: 2rem;
            }
            
            .mobile-toggle {
                display: flex;
                align-items: center;
                justify-content: center;
            }
            
            .panel-content {
                display: none;
            }
            
            .panel-content.expanded {
                display: block;
            }
        }
        /* ======================================== */
        /* EASTER EGG STYLES                        */
        /* ======================================== */

        .falling-element {
            transition: transform 1s cubic-bezier(0.5, 1.6, 0.4, 0.7);
            transform: translateY(var(--fall-distance)) rotate(var(--fall-rotate));
            
            pointer-events: none;
            position: relative; 
            z-index: 10; 
            
            opacity: 1 !important; 
        }

        #secret-poem-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            
            background-color: rgba(0, 0, 0, 0.7); 
            backdrop-filter: blur(2px);
            
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 1s ease-in;
            z-index: 9999;
        }

        #secret-poem-overlay.visible {
            opacity: 1;
            visibility: visible;
        }

        .secret-content {
            text-align: center;
            max-width: 600px;
            padding: 3rem;
            
            background-color: var(--bg-color); 
            color: var(--text-color);
            
            border: 2px solid var(--accent-color);
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            position: relative;
        }

        .secret-content h2 {
            margin-bottom: 1.5rem;
            color: var(--accent-color);
            font-family: 'EB Garamond', serif;
        }

        .secret-content button {
            margin-top: 1.5rem;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            background: var(--accent-color);
            color: #fff;
            border: none;
            border-radius: 4px;
            font-family: 'EB Garamond', serif;
            font-size: 1.1rem;
            transition: background 0.3s;
        }

        .secret-content button:hover {
            background-color: var(--heading-color);
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="site-header">
            <a href="#" class="logo" id="logo-link">Versi riflessi</a>
            <div class="header-right">
                <button id="theme-toggle" class="theme-switcher" aria-label="Toggle dark mode">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" 
                        viewBox="0 0 24 24" 
                        width="24" height="24" 
                        stroke="currentColor" fill="none" 
                        stroke-width="2" stroke-linecap="round">
                    
                        <circle cx="12" cy="12" r="5" fill="currentColor"/>

                        <line x1="12" y1="1"  x2="12" y2="4"/>
                        <line x1="12" y1="20" x2="12" y2="23"/>
                        <line x1="1"  y1="12" x2="4"  y2="12"/>
                        <line x1="20" y1="12" x2="23" y2="12"/>
                        
                        <line x1="4.22" y1="4.22" x2="6.34" y2="6.34"/>
                        <line x1="17.66" y1="17.66" x2="19.78" y2="19.78"/>
                        
                        <line x1="17.66" y1="6.34" x2="19.78" y2="4.22"/>
                        <line x1="4.22" y1="19.78" x2="6.34" y2="17.66"/>
                    </svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                </button>
            </div>
        </header>

        <main>
            <div class="book-layout">
                <aside class="left-panel">
                    <button class="mobile-toggle" id="mobile-toggle" aria-label="Mostra/nascondi elenco poesie">
                        Elenco poesie
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 16l-6-6h12l-6 6z"/>
                        </svg>
                    </button>
                    <div class="panel-content" id="panel-content">
                        <div class="search-container">
                            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10 2a8 8 0 105.293 14.293l4.907 4.907a1 1 0 001.414-1.414l-4.907-4.907A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"></path></svg>
                            <input type="search" id="search-input" class="search-box" placeholder="Cerca per titolo o testo...">
                        </div>
                        <ul id="poems-toc">
                        </ul>
                    </div>
                </aside>

                <div class="content-viewer">
                    
                    <section id="poems-view" class="active">
                        <div id="poem-display-area">
                            <div class="page-content">
                                <h2>Versi riflessi</h2>
                                <p>Versi riflessi nasce per condividere le poesie che ho scritto. Spero che a qualcuno possano piacere e che magari possano far riflettere un po'.</p>
                                <br>
                                <h3>L'autore</h3>
                                <p>Mi chiamo Davide, sono un informatico, e di tanto in tanto mi diletto con qualche passione secondaria come scrivere poesie.</p>
                                <br>
                                <h3>Contattami</h3>
                                <p>Se ti va, puoi lasciare un messaggio, una riflessione o un saluto.</p>
                                <p>Puoi scrivermi a: <a href="mailto:contact@versiriflessi.net">contact@versiriflessi.net</a></p>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </main>
        
        <footer class="site-footer">
            <p>&copy; 2025 • Versi riflessi</p>
        </footer>
    </div>
    <div id="secret-poem-overlay">
        <div class="secret-content">
            <h2>Grazie</h2>
            <div class="poem-text" style="font-style: italic; margin-bottom: 2rem;">
                <div>Hei tu, lettore</div>
                <div>che leggi versi</div>
                <div>scritti in ore e ore</div>
                <div>il riflesso è rotto</div>
                <div>grazie!</div>
            </div>
            <button id="reset-site-btn">Rifletti ancora</button>
        </div>
    </div>
    <div id="secret-poem-overlay">
        <div class="secret-content">
        </div>
    </div>
    <script>
        // ========================================
        // POEM DATA
        // ========================================
        const poems = [
            {
                id: 'numeri-naturali',
                title: 'Numeri naturali',
                date: '2024-02-29',
                lines: [
                    'Gli alberi fogliano',
                    'gli uccelli cantano',
                    'mezza età della terra',
                    'adolescenza della natura,',
                    'incontenibile dai numeri',
                    'che pure la definiscono.'
                ],
                note: 'Scritta il 29 Febbraio, pensando a quanto la matematica è il miglior strumento che abbiamo per descrivere la natura, nonostante la natura non sarà mai imbrigliabile dai numeri. I primi quattro versi si riferiscono proprio alla primavera che stà arrivando, e descrivono come la natura sia complessa, come in un uomo possono esserlo l\'adolescenza e la mezz\'età, entrambi aggettivi che descrivono per bene anche la primavera.'
            },
            {
                id: 'ciclo-dell-acqua',
                title: 'Il ciclo dell\'acqua',
                date: '2025-07-11',
                lines: [
                    'Lenta muta la nube',
                    'nell\'ondoso specchio',
                    'ciò che sarà oggi è',
                    'per se stessa passando',
                    'identici raggi di sole.',
                    '',
                    'E il due uno diventa',
                    'separa e unisce',
                    'finisce dove non sa',
                    'ai suoi simili cantando',
                    'una vecchia musica nuova'
                ],
                note: 'Scritta in riva al mare, racconta dell\'acqua e del suo percorso, focalizzandosi su una goccia. La nube, che è acuqa, si riflette nel mare, e pensa che essa è ciò che un domani sarà, chiudendo il ciclo dell\'acqua. Ma nonostante essa continua il suo ciclo, il resto del mondo non cambia, i raggi del sole sono identici, e si separano e uniscono in un arcobaleno, mentre la nuvola precipita come pioggia nel mare, diventando uno. È sempre l\'arcobaleno che finisce dove non sa, e canta la musica, cioè il rumore della pioggià che è vecchia come il mondo, eppure nuova ogni volta.'
            },
            {
                id: 'foresta',
                title: 'Foresta',
                date: '2025-08-26',
                lines: [
                    'La verde mente folta',
                    'senza trovare pace',
                    'comunicando tace',
                    'melodie cantando',
                    '',
                    'All\'uccellin in cima',
                    'fa eco la sua voce',
                    'passando per la foce',
                    'senza quiete andando',
                    '',
                    'Giunge al formicaio',
                    'la mente si riposa',
                    'vedendo la sua casa',
                    'tranquillità gustando',
                ],
                note: 'Scritta pensando al paragone tra una foresta e il cervello: gli alberi corrispondono ai neuroni, le connessioni alle foglie e alle radici. Nella prima strofa si introduce il tema della foresta e della comunicazione, cioè delle melodie della foresta, come il vento tra gli alberi, che vengono cantate "senza trovar pace", senza tranquillità. La stessa cosa succede all\'uccellino della seconda strofa, che canta e sente solo la sua voce, evocando quindi un senso di solitudine, mentre dalla cima di un albero, scende verso la foce di un fiume, senza quiete (proprio perché canta). La terza strofa invece ritrova la pace e la tranquillità di una formica che ritorna al suo formicaio e che già pregusta la calma e il riposo che la dentro può trovare. Non a caso la formica, dato che le formiche non emettono suoni, e possono quindi rimanere tranquille.'
            },
            {
                id: 'il-viaggio-della-medusa',
                title: 'Il viaggio della medusa',
                date: '2025-08-28',
                lines: [
                    'Ed ecco la medusa',
                    'che domani si sposa',
                    'ma la porta è chiusa',
                    'e muore la mimosa.',
                    '',
                    'In cerca di una scusa',
                    'in giornata afosa',
                    'riparte la medusa',
                    'triste e pensierosa.',
                    '',
                    'Tutto ciò che ha usa',
                    'per cercare qualcosa',
                    'che gli faccia da musa',
                    'nella vita noiosa'
                ],
                note: 'Scritta pensando ad un amore che non è corrisposto. La medusa si vuole sposare un domani, ma trova la porta chiusa, cioè il suo amore non è corrisposto, e muore la mimosa che ha portato dentro grazie alla felicità dell\'amore. Subita la delusione va in giro cercando di capire il perché (una scusa) non sia stata accettata, in una giornata afosa, cioè calda e soffocante. Superato l\'amore, rimane solo un vuoto, che deve essere colmato da qualcosa o qualcuno, e la medusa lo cerca senza sosta usando tutte le proprie risorse.'
            },
            {
                id: 'transizione-di-fase',
                title: 'Transizione di Fase',
                date: '2025-08-31',
                lines: [
                    '"Attenti! Sta crollando"',
                    'urla il capitano',
                    'la cenere volando',
                    'è rotta la verità.',
                    '',
                    'Caduta è la Torre',
                    'in oceano di fiamme.',
                    'Ecco prega e corre',
                    'disperato si tuffò.',
                    '',
                    'In cerca di riparo',
                    'arriva a nuova riva',
                    'ora è tutto chiaro',
                    'Ecco l\'acqua sorgiva'
                ],
                note: 'La transizione di fase è quel processo per cui una sostanza passa da uno stato della materia ad un altro. In questo contesto indica il cambio di idee, la rottura delle certezze vecchie per formare verità nuove. La poesia è un continuo parallelismo tra un castello che cade durante una battaglia e un soldato che, perso il castello e trovandosi senza certezze, infine giunge a una nuova idea, ad una nuova tranquillità data da una nuova sorgente.'
            },
            {
                id: 'il-giardino-dietro-casa',
                title: 'Il giardino dietro casa',
                date: '2025-08-31',
                lines: [
                    'In giro per il mondo',
                    'tanti piccoli posti',
                    'io vado visitando:',
                    'calmi luoghi nascosti.',
                    '',
                    'Sulla strada un segno',
                    'di un vicino ignoto',
                    'di curiosità lo degno',
                    'ecco: scatto una foto.',
                    '',
                    'E dopo una vita',
                    'con chi mi sta intorno',
                    'vado per la salita:',
                    'vecchi legami formo.'
                ],
                note: 'Scritta ripensando a tutte le cose che ci stanno vicino, ma che non degnamo mai di uno sguardo. Questo finché non decidiamo di farci una passeggiata, e scoprire tante piccole cose che attirano la nostra curiosità, stupendoci molto più di quanto possa fare tutto il resto.'
            },
            {
                id: 'discorso-temporale',
                title: 'Discorso temporale',
                date: '2025-09-07',
                lines: [
                    'Come parla il tempo',
                    'nessuno lo comprende',
                    'va avanti senza scampo:',
                    'eppure lo si vende.',
                    '',
                    'Neutre notizie porta',
                    'il ticchettio lento',
                    'che pure ci conforta',
                    'come un calmo vento.',
                    '',
                    'Nostalgia io sento',
                    'di lontano ricordo',
                    'e sentendo mi pento:',
                    'sento dolore sordo.',
                ],
                note: 'Questa poesia ha un significato più esplicito delle altre. Il tema principale è il tempo che passa e tutte le cose che porta (le parole che parla), come noi lo sprechiamo, la nostalgia e i rimpianti del passato.'
            },
            {
                id: 'spese-di-contesto',
                title: 'Spese di contesto',
                date: '2025-09-09',
                lines: [
                    'Chi pagherà il costo',
                    'della vita coerente',
                    'del mio piccolo posto',
                    'trovato finalmente.',
                    '',
                    'Oscuro è il motivo',
                    'strana è la ragione',
                    'fa principio attivo',
                    'il contesto d\'azione.',
                    '',
                    'Il perché io agisco',
                    'sento nel fragore',
                    'del girevole disco',
                    'sul perpetuo rotore',
                ],
                note: 'A volte vogliamo aderire a determinati principi, diciamo di voler e voler fare cose per aderire a quei principi, ma ci pesa, all\'atto pratico, fare quelle cose: è questo il costo della coerenza. Allo stesso modo, il contesto ci influenza a credere e fare molte cose, ed anche questo è un costo che passiamo. I motivi però si trovano solo dentro di noi, scritti su quel disco, che è il cervello, che non si ferma mai.'
            },
            {
                id: 'continuo',
                title: 'Continuo',
                date: '2025-09-09',
                lines: [
                    'In superficie arriva',
                    'un pensiero profondo',
                    'e vede sulla riva',
                    'uno strano nuovo mondo.',
                    '',
                    'Quanti pari mai visti',
                    'incontra sul cammino',
                    'vecchi, giovani, misti',
                    'ed esterni perfino.',
                    '',
                    'Ma come lui nessuno',
                    'che possa fare da re',
                    'si chinano uno ad uno',
                    'finché pace non c\'è.',
                    '',
                    'Un\'inaspettata voce',
                    'alzandosi veloce',
                    'il nuovo re uccide',
                    'tutti quanti deride.',
                    '',
                    'Finché piccolo nasce',
                    'un pensiero in fasce',
                    'dal mezzo egli proviene',
                    'un\'idea nuova sostiene.',
                    '',
                    'La pace egli riporta',
                    'lottando con ardore',
                    'il popolo conforta',
                    'che segue con furore.',
                    '',
                    'Un ultimo sguardo lancia',
                    'all\'ordine che ha posto',
                    'saziando la sua pancia',
                    'e pagando ogni costo.',
                    '',
                    '"Addio" infine dice',
                    'e torna al profondo',
                    'dove guarda felice',
                    'il continuo del mondo.'
                ],
                note: 'Lo scontro tra idee diverse è un processo grandioso e terribile, sopratutto quando riguarda quei principi profondi, radicati in noi, sui quali basiamo buona parte della conoscenza. Questo processo può attraversare varie fasi, da quella distruttiva dello scontro a quelle costruttive di messa in ordine e lotta per nuove idee. Infine il processo si conclude con nuovi pensieri che divengono la base della conoscenza, in attesa anche questi di subire lo stesso processo dei loro predecessori.'
            },
            {
                id: 'ricerca-di-luci',
                title: 'Ricerca di luci',
                date: '2025-09-16',
                lines: [
                    'Brama, ma non vuole',
                    'cerca, ma non trova',
                    'la fonte d\'ogni sole',
                    'dove nube non cova.',
                    '',
                    'Nella vita più volte',
                    'si cade in una fossa',
                    'a causa delle molte',
                    'idee in carne ed ossa.',
                    '',
                    'Molte luci io vedo',
                    'e vado in confusione',
                    'per l\'esponente io cedo',
                    'che supera il milione.'
                ],
                note: 'Quante volte ci sentiamo sopraffatti dalle idee? Ecco di cosa parla questa poesia.'
            },
            {
                id: 'alberi-sul-lago',
                title: 'Alberi sul lago',
                date: '2025-09-17',
                lines: [
                    'Ecco un Lago montano',
                    'innumerevoli alberi lo coprono',
                    'con ombrosa luce di pace.',
                    'Volano sull\'acqua sostenuti',
                    'da se stessi solo dipendono',
                    'per avere nutrimento di vita',
                    'e dare al mondo se stessi.'
                ],
                note: 'Suggestioni di un paesaggio onirico.'
            },
            {
                id: 'percezioni',
                title: 'Percezioni',
                date: '2025-09-20',
                lines: [
                    'Piccolo vecchie percezioni',
                    'per lungo tempo dimenticate',
                    'io nuovamente sento',
                    'camminando per la vita.',
                    '',
                    'E da queste vecchie cose',
                    'sempre nuove ne nascono',
                    'in inaspettati strani modi',
                    'che per un piccolo istante',
                    'mi conquistano.',
                    '',
                    'E dall\'unione nasco io',
                    'un pezzo per volta:',
                    'uno nel passato inconscio,',
                    'uno nel presente scivoloso,',
                    'uno nel futuro inafferrabile.'
                ],
                note: 'Spesso sento delle sensazioni che fanno parte del mio passato. E con il passare del tempo queste si modificano, cambiano faccia e diventano qualcosa che non avrei mai pensato potessero essere.'
            },
            {
                id: 'eco-nel-tempo',
                title: 'Eco nel tempo',
                date: '2025-09-20',
                lines: [
                    'La stasi temporale è quel momento',
                    'in cui un qualcosa io sento.',
                    'La stasi...',
                    'Io sento...',
                    '',
                    'Un cristallo temporale è qualcosa',
                    'in cui pace io cerco.',
                    'Un cristallo...',
                    'Io cerco...',
                    '',
                    'La pace temporale è quel processo',
                    'in cui sensazioni io provo.',
                    'La pace...',
                    'Io provo...',
                    '',
                    'La sensazione temporale è qualcosa',
                    'che con tutto me stesso io voglio.',
                    'La sensazione...',
                    'Io voglio...',
                    '',
                    'Il me stesso temporale io sono.',
                    'Me stesso...',
                    'Io sono.'
                ],
                note: 'Ci sentiamo spesso intrappolati in un ciclo che non ha fine. Ma ci sono dei momenti che non vorremmo che passino mai.'
            },
            {
                id: 'cura-alla-solitudine',
                title: 'Cura alla solitudine',
                date: '2025-09-23',
                lines: [
                    'Quando sei solo nella stanza',
                    'esci fuori e vai a guardare',
                    'lo specchio vivente che danza',
                    'che per le vie del mondo appare.',
                    '',
                    'Eppure per noi è molto difficile',
                    'parlare con il riflesso esterno',
                    'poiché diverso è quanto è simile:',
                    'egli è unico rifugio nell\'inverno.',
                    '',
                    'Solo negandoci troviamo il tesoro',
                    'che nel mondo ha più valore',
                    'eppure lo scambiamo per arido oro',
                    'e poi ci lamentiamo per lunghe ore.'
                ],
                note: 'Quanto è difficile confrontarsi con la realtà delle altre persone, con i loro sentimenti, con l\'amore, con l\'amicizia.'
            },
            {
                id: 'espressione-esponenziale',
                title: 'Espressione esponenziale',
                date: '2025-10-01',
                lines: [
                    'Quello che un verso può diventare',
                    'l\'occhio attento ce lo deve dire',
                    'facendo così l\'euristica dominare.',
                    '',
                    'Combinazioni infinite ci sono',
                    'che contarle ti fa invecchiare',
                    'come musica con più di un tono',
                    '',
                    'In questo quello che facciamo è vita',
                    'che a tentoni cerca di migliorare',
                    'per cupe valli facendo una gita.'
                ],
                note: 'La realtà che vediamo è un\'esplosione esponenziale di molte variabili, che solo l\'occhio umano, come la selezione naturale, possono cercare di dominare tramite l\'euristica. è da qui che nasce l\'arte.'
            },
            {
                id: 'in-giro-ispirazioni',
                title: 'In giro, ispirazioni',
                date: '2025-10-01',
                lines: [
                    'Come il suono ci ispira',
                    'vita ed esperienze possiamo fare',
                    'tutte le volte a riprovare',
                    'come a se il tempo ci tira.',
                    '',
                    'Colori liberi alla confusione vanno',
                    'tanto che molti vogliono cancellare',
                    'perché non vedono ciò che appare',
                    'e la libertà della vita non sanno.',
                    '',
                    'Colori e suoni insieme stanno',
                    'per il nostro diletto lavorare',
                    'che ci porta sempre a pensare:',
                    'tante nuove esperienze diverranno.'
                ],
                note: 'Quando siamo in giro, come quando siamo soli, alcuni suoni ed alcuni colori ci ispirano grandi emozioni. I colori possono sembrare anche confusi, ma non per alcuni a cui questi colori donano vita e, insieme ai suoni, generano nuove esperienze.'
            },
            {
                id: 'per-i-picchi',
                title: 'Per i picchi',
                date: '2025-10-01',
                lines: [
                    'Ciò che ci fa stare bene',
                    'è l\'idea di qualcosa di banale',
                    'che ci faccia spostare di un canale',
                    'la ricerca della nostra vita.',
                    '',
                    'Mi giro, mi volto',
                    'di nuovo all\'inizio mi trovo',
                    'proprio all\'uscita del mio covo',
                    'che per molto vicino mi stà.',
                    '',
                    'Mi sposto, scappo un po\'',
                    'ma dalle ombre fuga non c\'è',
                    'tanto che la testa mi gira come te',
                    'insieme scalando questa via.',
                    '',
                    'Picchi improvvisi io vedo:',
                    'gioia al pensiero di salire',
                    'ma si abbassa prima di partire',
                    'e di nuovo sono in questo piatto mar.'
                ],
                note: 'Una nuova idea ci spesso ci conquista, fino a quando non ci rendiamo conto che di fatto è una cosa normalissima, ci passa l\'entusiasmo e torniamo come prima.'
            },
            {
                id: 'radici-di-me',
                title: 'Radici di me',
                date: '2025-10-04',
                lines: [
                    'Dentro di me radici profonde',
                    'l\'originario albero ha messo',
                    'tanto che anche adesso',
                    'il ferro non rompe le onde',
                    'della vita piantata a terra.',
                    '',
                    'E mentre sempre più',
                    'da essa lontano vado',
                    'triste sono non di rado',
                    'per il verde che non vè più:',
                    'solo esso vita può dare.'
                ],
                note: 'Sempre più stiamo andando verso un mondo fatto di metallo e silicio. Ogni tanto è bene tornare alla natura, alle foglie, alle radici.'
            },
            {
                id: 'dove-mi-trovo',
                title: 'Dove mi trovo',
                date: '2025-10-06',
                lines: [
                    'Scherzare piace al passaggio',
                    'delle comete, e del saggio,',
                    'del niente, del poco, del tutto',
                    'pieno di nascita e di lutto.',
                    '',
                    'A volte, corto',
                    'finché non morto',
                    'è il gaio sentire',
                    'del gioco a non finire.',
                    '',
                    'A quel punto decisamente lungo diventa',
                    'e più va avanti e più la noia ritenta:',
                    'il controllo vuole e mai se ne vuole andare',
                    'a casa della pace non mi vuole portare.',
                    '',
                    'Infine sveglio mi ritrovo',
                    'senza buco nero, senza vuoto covo',
                    'e nulla mi rimane da fare',
                    'se non il tempo imparare ad apprezzare.'
                ],
                note: 'A volte il tempo ci sembra lungo, a volte ci sembra corto. Tutto dipende da noi, da come lo trascorriamo. A volte siamo nel vuoto, a volte vicino ad un buco nero, ma poi quello che conta è imparare ad apprezzarlo.'
            },
            {
                id: 'problemi-di-spazio',
                title: 'Problemi di spazio',
                date: '2025-10-20',
                lines: [
                    'Col tempo la memoria',
                    'io devo deallocare',
                    'per fare un po\' baldoria.',
                    '',
                    'Non voglio dimenticare',
                    'i bei momenti di vita',
                    'ma spazio io Devo fare.',
                    '',
                    'Nell\'overflow partita',
                    'ci perde ogni persona',
                    'fin quando tutta è finita.'
                ],
                note: 'Ogni tanto abbiamo bisogno di nuovo spazio nella nostra vita, per poter iniziare nuove cose, nuovi percorsi. Non possiamo semplicemente continuare ad accumulare, per il semplice fatto che noi siamo in grado di gestire solo un numero costante di cose contemporaneamente'
            },
            {
                id: 'contesto',
                title: 'Contesto',
                date: '2025-10-21',
                lines: [
                    'La macchia si sposta',
                    'si muove, si scosta',
                    'preparo nel prato',
                    'un bello stufato',
                    'di carne squisita',
                    'profuma di vita',
                    'decide le cose',
                    'diventan famose',
                    'per buona ricetta',
                    'mi taglio una fetta',
                    'pensando le frasi',
                    'a lungo rimasi',
                    'la macchia guardando',
                    'grande diventando',
                    'rimasi me stesso',
                    'trovando un nesso',
                    'mangiando la carne',
                    'sapendo che farne',
                    'mi alzo, inseguo',
                    'la vita proseguo',
                    'nel mondo io dormo',
                    'che sogni che formo',
                    'onirico regno',
                    'che fatto di legno',
                    'increspa le onde',
                    'le rompe, le fonde',
                    'mi sveglio cresciuto',
                    'l\'ho sempre saputo',
                    'chiara è quest\'ora',
                    'che mondo ristora',
                    'indicazione dando',
                    'lo guardo studiando.'
                ],
                note: 'Per capire a fondo qualcosa, è importante analizzarne il contesto. Ciò che a prima impressione sembra qualcosa, riguardandola ci sembra altro. Il contesto è l\'informazione stessa, o buona parte di essa, che come una macchia la segue.'
            },
            {
                id: 'calma-delle-piante',
                title: 'Calma delle piante',
                date: '2025-10-25',
                lines: [
                    'La danza di lance',
                    'delizia le pance',
                    'dell\'occhio e del cuore.',
                    '',
                    'Da solo per ore',
                    'sto col mio avo',
                    'una buca io scavo.',
                    '',
                    'Pianto un virgulto',
                    'che ricorda un sussulto',
                    'che insegna chi sono.',
                    '',
                    'Rosso è il dono',
                    'della lunga vita',
                    'in moto, infinita.'
                ],
                note: 'Le piante, come i nostri avi, ci possono insegnare tantissimo, se solo vorremmo ascoltarli.'
            },
            {
                id: 'semplice-o-complesso',
                title: 'Semplice o Complesso',
                date: '2025-11-11',
                lines: [
                    'In questa realtà',
                    'mi sento schiacciato',
                    'dalla complessità',
                    'dell\'universo infinito.',
                    'Conoscendo l\'errore:',
                    'converge il semplice',
                    'in realtà indeterminate'
                ],
                note: 'Ci sono due realtà infinitamente semplici, che sono la realtà fisica vera e propria, dove non esiste astrazione e tutto e uguale solo a se stesso, e la realtà di Dio, che è infinitamente semplice perché racchiude tutto in se stesso: Amore. Ma noi viviamo nella terra di mezzo, in questa infinita complessità.'
            },
            {
                id: 'lento-e-cangiante',
                title: 'Lento e cangiante',
                date: '2025-11-20',
                lines: [
                    'Lento e cangiante',
                    'ma noi nessun pixel',
                    'vediamo mutante.',
                    '',
                    'di volta in volta', 
                    'traslato è stato',
                    'distanza non molta.',
                    '',
                    'Ma la somma',
                    'grande diventa',
                    'tanto che in overflow',
                    'manda la gomma.'
                ],
                note: 'I cambiamenti sono lenti e continui. Noi spesso non ce ne rendiamo conto. Ma ad un certo punto, vengono accumulati così tanti cambiamenti che è impossibile tornare indietro. Questa è anche una delle teorie più accreditate per quanto riguarda l\'invecchiamento: si accumulano progressivamente tanti errori nel DNA.'
            }
        ];
        document.addEventListener('DOMContentLoaded', () => {

            // ========================================
            // THEME SWITCHER LOGIC
            // ========================================
            const themeToggle = document.getElementById('theme-toggle');
            const htmlEl = document.documentElement;

            const applyTheme = (theme) => {
                htmlEl.classList.toggle('dark-mode', theme === 'dark');
            };

            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            applyTheme(savedTheme);

            themeToggle.addEventListener('click', () => {
                const isDarkMode = htmlEl.classList.contains('dark-mode');
                const newTheme = isDarkMode ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });


            // ========================================
            // MAIN APPLICATION LOGIC
            // ========================================
            const contentSections = document.querySelectorAll('.content-viewer > section');
            const poemsToc = document.getElementById('poems-toc');
            const poemDisplayArea = document.getElementById('poem-display-area');
            const searchInput = document.getElementById('search-input');
            const logoLink = document.getElementById('logo-link');
            const mobileToggle = document.getElementById('mobile-toggle');
            const panelContent = document.getElementById('panel-content');

            const welcomeMessageHTML = poemDisplayArea.innerHTML;
            
            // --- 1. Populate Table of Contents ---
            poems.sort((a, b) => new Date(a.date) - new Date(b.date));
            poemsToc.innerHTML = poems.map(poem => `
                <li><a href="#${poem.id}" data-poem-id="${poem.id}">${poem.title}</a></li>
            `).join('');
            
            const tocLinks = poemsToc.querySelectorAll('a');

            // --- 2. Core Functions ---
            const displayPoem = (poemId) => {
                const poem = poems.find(p => p.id === poemId);
                if (!poem) return;

                // Creiamo l'HTML delle note solo se la nota esiste
                const noteHTML = poem.note 
                    ? `<div class="poem-notes">
                            <strong>Nota dell'autore:</strong><br>
                            ${poem.note}
                        </div>` 
                    : '';

                const poemHTML = `
                    <article class="poem-display">
                        <h2 id="active-poem-title">${poem.title}</h2>
                        <p class="poem-meta">${new Date(poem.date).toLocaleDateString('it-IT', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <div class="poem-text">
                            ${poem.lines.map(line => `<div>${line || '&nbsp;'}</div>`).join('')}
                        </div>
                        ${noteHTML}
                    </article>
                `;
                poemDisplayArea.innerHTML = poemHTML;
                
                // --- LOGICA DEI 5 CLICK ---
                const titleElement = document.getElementById('active-poem-title');
                const notesElement = poemDisplayArea.querySelector('.poem-notes');
                let clickCount = 0;

                // Se ci sono note e il titolo esiste, aggiungiamo il listener
                if (titleElement && notesElement) {
                    titleElement.addEventListener('click', () => {
                        clickCount++;
                        
                        // Se arriviamo a 5 click
                        if (clickCount === 5) {
                            notesElement.classList.add('revealed');
                            // Opzionale: scrolla leggermente verso le note per far vedere che sono apparse
                            notesElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                            clickCount = 0; // Reset del contatore
                        }
                    });
                }
                
                tocLinks.forEach(link => link.classList.toggle('active', link.dataset.poemId === poemId));
            };

            const switchView = (viewId) => {
                contentSections.forEach(section => section.classList.toggle('active', section.id === viewId));
            };

            const resetToHomeView = () => {
                switchView('poems-view');
                poemDisplayArea.innerHTML = welcomeMessageHTML;
                tocLinks.forEach(link => {
                    link.classList.remove('active');
                    link.parentElement.style.display = '';
                });
                searchInput.value = '';
                history.pushState("", document.title, window.location.pathname + window.location.search);
            };

            const toggleMobilePanel = () => {
                const isExpanded = panelContent.classList.contains('expanded');
                panelContent.classList.toggle('expanded');
                mobileToggle.classList.toggle('expanded');
                
                mobileToggle.setAttribute('aria-expanded', !isExpanded);
            };

            const closeMobilePanelIfOpen = () => {
                if (window.innerWidth <= 900 && panelContent.classList.contains('expanded')) {
                    panelContent.classList.remove('expanded');
                    mobileToggle.classList.remove('expanded');
                    mobileToggle.setAttribute('aria-expanded', 'false');
                }
            };
            
            // --- 3. Event Listeners ---
            logoLink.addEventListener('click', (e) => {
                e.preventDefault();
                resetToHomeView();
                closeMobilePanelIfOpen();
            });

            mobileToggle.addEventListener('click', toggleMobilePanel);

            poemsToc.addEventListener('click', (e) => {
                if (e.target.tagName === 'A' && e.target.dataset.poemId) {
                    e.preventDefault();
                    switchView('poems-view');
                    displayPoem(e.target.dataset.poemId);
                    window.location.hash = e.target.hash;
                    closeMobilePanelIfOpen();
                }
            });

            window.addEventListener('resize', () => {
                if (window.innerWidth > 900) {
                    panelContent.classList.remove('expanded');
                    mobileToggle.classList.remove('expanded');
                    mobileToggle.setAttribute('aria-expanded', 'false');
                }
            });

            // ========================================
            // EASTER EGG LOGIC
            // ========================================
            
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                if (searchTerm.trim() === 'lettere') {
                    triggerEasterEgg();
                    return; 
                }

                poems.forEach(poem => {
                    const title = poem.title.toLowerCase();
                    const content = poem.lines.join(' ').toLowerCase();
                    const isMatch = title.includes(searchTerm) || content.includes(searchTerm);
                    
                    const linkElement = poemsToc.querySelector(`[data-poem-id="${poem.id}"]`);
                    if (linkElement) {
                        linkElement.parentElement.style.display = isMatch ? '' : 'none';
                    }
                });
            });

            const triggerEasterEgg = () => {
                const targets = [
                    document.querySelector('.site-header'),
                    document.querySelector('.left-panel'),
                    ...document.querySelectorAll('.content-viewer > section'), 
                    document.querySelector('.site-footer')
                ];

                const windowHeight = window.innerHeight;

                targets.forEach(el => {
                    if(el && getComputedStyle(el).display !== 'none') {
                        const rect = el.getBoundingClientRect();
                        
                        let distanceToBottom = windowHeight - rect.bottom;
                        
                        const pileRandomness = Math.random() * 80; 
                        const finalDrop = Math.max(0, distanceToBottom - pileRandomness);
                        
                        const randomDeg = (Math.random() * 20) - 10;

                        el.style.setProperty('--fall-distance', `${finalDrop}px`);
                        el.style.setProperty('--fall-rotate', `${randomDeg}deg`);
                        
                        el.classList.add('falling-element');
                    }
                });

                setTimeout(() => {
                    document.getElementById('secret-poem-overlay').classList.add('visible');
                }, 1500);
            };

            // RESET FUNCTION
            const resetBtn = document.getElementById('reset-site-btn');
            if (resetBtn) {
                resetBtn.addEventListener('click', () => {
                    document.getElementById('secret-poem-overlay').classList.remove('visible');
                    const targets = document.querySelectorAll('.falling-element');
                    targets.forEach(el => {
                        el.classList.remove('falling-element');
                        el.style.removeProperty('--fall-distance');
                        el.style.removeProperty('--fall-rotate');
                        el.style.transform = ''; 
                    });
                    searchInput.value = '';
                    searchInput.focus();
                    const allLinks = poemsToc.querySelectorAll('li');
                    allLinks.forEach(li => li.style.display = '');
                });
            }

            // --- 4. Handle Initial Page Load ---
            const currentHash = window.location.hash.substring(1);
            const poemLink = Array.from(tocLinks).find(link => link.hash === `#${currentHash}`);

            if (poemLink) {
                switchView('poems-view');
                displayPoem(poemLink.dataset.poemId);
            } else {
                switchView('poems-view');
            }
        });

    </script>
    <script>
        if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("service-worker.js")
            .then(() => console.log("Service Worker registered"))
            .catch(err => console.error("SW registration failed:", err));
        }
    </script>
</body>
</html>