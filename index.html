<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Versi riflessi - A Collection</title>
    
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64,AAABAAEAEBAQAAEABAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAPgAAAAF+oABWcAwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEREREREREREREREREREREREiEREREREREREhEREhERERERIRIiERERERESIiIhERERERIAACIRERERIgAiIhEREREiAgAAIREREiICACIhEREREiICAAIRERERIgIAIhERERERIgICERERERERIiIREREREREREREREREREREREAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA">

    <style>
        /* ======================================== */
        /* THEME & BASE STYLES                      */
        /* ======================================== */
        :root {
            /* Light Theme (Default) */
            --bg-color: #fdf6e3; /* A soft, book-page cream */
            --text-color: #333333;
            --heading-color: #5d4037; /* Muted brown */
            --accent-color: #a0522d; /* Sienna, a classic accent */
            --border-color: #e0d9c6;
            --panel-bg: rgba(255, 255, 255, 0.5);
        }

        html.dark-mode {
            /* Dark Theme */
            --bg-color: #1e1e1e;
            --text-color: #dcdcdc;
            --heading-color: #e0e0e0;
            --accent-color: #d4af37; /* Gold stands out in the dark */
            --border-color: #444444;
            --panel-bg: rgba(40, 40, 40, 0.5);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Source Serif Pro', 'Georgia', serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            font-size: 17px;
            transition: background-color 0.3s, color 0.3s;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        h1, h2, h3 {
            font-family: 'Playfair Display', 'Times New Roman', serif;
            color: var(--heading-color);
            line-height: 1.3;
        }
        
        a {
            color: var(--accent-color);
            text-decoration: none;
            transition: color 0.2s;
        }
        a:hover {
            text-decoration: underline;
        }

        /* ======================================== */
        /* HEADER & NAVIGATION                      */
        /* ======================================== */
        .site-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 2rem;
        }

        .logo {
            font-family: 'Playfair Display', serif;
            font-size: 1.8rem;
            font-weight: 700;
            font-style: italic;
            color: var(--heading-color);
        }
        .logo:hover {
            text-decoration: none;
        }
        
        .header-right {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .main-nav a {
            font-size: 1.1rem;
            margin-left: 1.5rem;
            padding-bottom: 5px;
            border-bottom: 2px solid transparent;
        }

        .main-nav a.active {
            border-bottom-color: var(--accent-color);
            font-weight: 600;
        }
        
        .theme-switcher {
            background: none; border: none; cursor: pointer; color: var(--text-color);
        }
        .theme-switcher svg { width: 22px; height: 22px; }
        .theme-switcher .moon-icon { display: none; }
        html.dark-mode .theme-switcher .moon-icon { display: block; }
        html.dark-mode .theme-switcher .sun-icon { display: none; }


        /* ======================================== */
        /* BOOK-STYLE LAYOUT                        */
        /* ======================================== */
        .book-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2.5rem;
            align-items: flex-start;
        }
        
        /* Left Panel: Table of Contents & Search */
        .left-panel {
            position: sticky;
            top: 2rem;
            border-right: 1px solid var(--border-color);
            padding-right: 2.5rem;
            height: calc(100vh - 4rem);
            overflow-y: auto;
        }
        .search-container {
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            width: 18px;
            height: 18px;
            fill: var(--text-color);
            opacity: 0.4;
        }
        .search-box {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 2.7rem;
            font-size: 1rem;
            font-family: 'Source Serif Pro', serif;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin-bottom: 1.5rem;
            margin-top: 1.5rem;
        }
        .search-box:focus {
            outline: none; /* Removes the default blue shadow */
            border-color: var(--accent-color);
        }

        #poems-toc {
            list-style: none;
        }

        #poems-toc li a {
            display: block;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            margin-bottom: 0.25rem;
            font-size: 1.05rem;
            color: var(--text-color);
        }

        #poems-toc li a:hover {
            background-color: var(--panel-bg);
            text-decoration: none;
        }
        
        #poems-toc li a.active {
            background-color: var(--accent-color);
            color: white;
            font-weight: 600;
        }
        html.dark-mode #poems-toc li a.active {
            color: #1e1e1e;
        }

        /* Right Panel: Content Viewer */
        .content-viewer {
            padding: 1rem 0;
        }
        
        .content-viewer > section {
            display: none; /* Hidden by default, shown by JS */
        }
        
        .content-viewer > section.active {
            display: block;
        }

        .poem-display h2 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .poem-meta {
            font-style: italic;
            color: #888;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .poem-text {
            font-size: 1.2rem;
            line-height: 2;
            max-width: 65ch; /* Optimal for reading */
        }
        
        .poem-commentary {
            margin-top: 3rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
            max-width: 65ch;
            font-style: italic;
            background-color: var(--panel-bg);
            padding: 1.5rem;
            border-radius: 5px;
        }
        .poem-commentary h3 {
            font-style: normal;
            margin-bottom: 1rem;
        }

        /* About Pages */
        .page-content {
            max-width: 70ch;
        }
        .page-content h2 {
            font-size: 2rem;
            margin-bottom: 1.5rem;
        }
        .page-content p {
            margin-bottom: 1rem;
        }
        
        /* Footer */
        .site-footer {
            text-align: center;
            margin-top: 4rem;
            padding-top: 2rem;
            font-size: 0.9rem;
            color: #888;
            border-top: 1px solid var(--border-color);
        }
        
        /* Responsive Design */
        @media (max-width: 900px) {
            .book-layout {
                grid-template-columns: 1fr;
            }
            .left-panel {
                position: static;
                height: auto;
                border-right: none;
                border-bottom: 1px solid var(--border-color);
                padding-right: 0;
                margin-bottom: 2rem;
                padding-bottom: 2rem;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <header class="site-header">
            <a href="#" class="logo" id="logo-link">Versi riflessi</a>
            <div class="header-right">
                <nav class="main-nav">
                    <a href="#about" data-view="about-view">Il progetto</a>
                </nav>
                <button id="theme-toggle" class="theme-switcher" aria-label="Toggle dark mode">
                    <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0V3a.75.75 0 01.75-.75zM7.5 12a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM18.894 6.106a.75.75 0 010 1.06l-1.591 1.59a.75.75 0 11-1.06-1.06l1.59-1.59a.75.75 0 011.06 0zM21.75 12a.75.75 0 01-.75.75h-2.25a.75.75 0 010-1.5H21a.75.75 0 01.75.75zM17.894 17.894a.75.75 0 01-1.06 0l-1.59-1.591a.75.75 0 111.06-1.06l1.59 1.59a.75.75 0 010 1.061zM12 18a.75.75 0 01.75.75v2.25a.75.75 0 01-1.5 0v-2.25A.75.75 0 0112 18zM6.106 17.894a.75.75 0 010-1.06l1.59-1.59a.75.75 0 111.06 1.06l-1.59 1.59a.75.75 0 01-1.06 0zM3 12a.75.75 0 01-.75.75H.75a.75.75 0 010-1.5h2.25A.75.75 0 013 12zM6.106 6.106a.75.75 0 011.06 0l1.591 1.59a.75.75 0 01-1.06 1.06l-1.59-1.59a.75.75 0 010-1.06z"></path></svg>
                    <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>
                </button>
            </div>
        </header>

        <main>
            <div class="book-layout">
                <aside class="left-panel">
                    <div class="search-container">
                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M10 2a8 8 0 105.293 14.293l4.907 4.907a1 1 0 001.414-1.414l-4.907-4.907A8 8 0 0010 2zm0 2a6 6 0 110 12A6 6 0 0110 4z"></path></svg>
                        <input type="search" id="search-input" class="search-box" placeholder="Cerca per titolo o testo...">
                    </div>
                    <ul id="poems-toc">
                    </ul>
                </aside>

                <div class="content-viewer">
                    
                    <section id="poems-view" class="active">
                        <div id="poem-display-area">
                            <div class="page-content">
                                <h2>Benvenuto</h2>
                                <p>Seleziona una poesia dalla lista a sinistra per iniziare la lettura.</p>
                                <p>Puoi anche usare la barra di ricerca per trovare un titolo specifico o una frase nel testo.</p>
                            </div>
                        </div>
                    </section>
                    
                    <section id="about-view">
                        <div class="page-content">
                            <h2>"Versi riflessi"</h2>
                            <p>Versi riflessi nasce per condividere le poesie che ho scritto. Spero che a qualcuno possano piacere e che magari possano far riflettere un po'.</p>
                            <br>
                            <h3>L'autore</h3>
                            <p>Mi chiamo Davide, sono un informatico, e di tanto in tanto mi diletto con qualche passione secondaria come scrivere poesie.</p>
                            <br>
                            <h3>Contattami</h3>
                            <p>Se ti va, puoi lasciare un messaggio, una riflessione o un saluto.</p>
                            <p>Puoi scrivermi a: <a href="mailto:placeholder@example.com">placeholder@example.com</a></p>
                        </div>
                    </section>
                </div>
            </div>
        </main>
        
        <footer class="site-footer">
            <p>&copy; 2025 • Versi riflessi</p>
        </footer>
    </div>

    <script>
        // ========================================
        // POEM DATA
        // ========================================
        const poems = [
            {
                id: 'numeri-naturali',
                count_view: 0,
                title: 'Numeri naturali',
                author: 'Davide',
                date: '2024-02-29',
                lines: [
                    'Gli alberi fogliano',
                    'gli uccelli cantano',
                    'mezza età della terra',
                    'adolescenza della natura,',
                    'incontenibile dai numeri',
                    'che pure la definiscono.'
                ],
                commentary: 'Scritta il 29 Febbraio, pensando a quanto la matematica è il miglior strumento che abbiamo per descrivere la natura, nonostante la natura non sarà mai imbrigliabile dai numeri. I primi quattro versi si riferiscono proprio alla primavera che stà arrivando, e descrivono come la natura sia complessa, come in un uomo possono esserlo l\'adolescenza e la mezz\'età, entrambi aggettivi che descrivono per bene anche la primavera.'
            },
            {
                id: 'ciclo-dell-acqua',
                count_view: 0,
                title: 'Il ciclo dell\'acqua',
                author: 'Davide',
                date: '2025-07-11',
                lines: [
                    'Lenta muta la nube',
                    'nell\'ondoso specchio',
                    'ciò che sarà oggi è',
                    'per se stessa passando',
                    'identici raggi di sole.',
                    '',
                    'E il due uno diventa',
                    'separa e unisce',
                    'finisce dove non sa',
                    'ai suoi simili cantando',
                    'una vecchia musica nuova'
                ],
                commentary: 'Scritta in riva al mare, racconta dell\'acqua e del suo percorso, focalizzandosi su una goccia. La nube, che è acuqa, si riflette nel mare, e pensa che essa è ciò che un domani sarà, chiudendo il ciclo dell\'acqua. Ma nonostante essa continua il suo ciclo, il resto del mondo non cambia, i raggi del sole sono identici, e si separano e uniscono in un arcobaleno, mentre la nuvola precipita come pioggia nel mare, diventando uno. È sempre l\'arcobaleno che finisce dove non sa, e canta la musica, cioè il rumore della pioggià che è vecchia come il mondo, eppure nuova ogni volta.'
            },
            {
                id: 'foresta',
                count_view: 0,
                title: 'Foresta',
                author: 'Davide',
                date: '2025-08-26',
                lines: [
                    'La verde mente folta',
                    'senza trovare pace',
                    'comunicando tace',
                    'melodie cantando',
                    '',
                    'All\'uccellin in cima',
                    'fa eco la sua voce',
                    'passando per la foce',
                    'senza quiete andando',
                    '',
                    'Giunge al formicaio',
                    'la mente si riposa',
                    'vedendo la sua casa',
                    'tranquillità gustando',

                ],
                commentary: 'Scritta pensando al paragone tra una foresta e il cervello: gli alberi corrispondono ai neuroni, le connessioni alle foglie e alle radici. Nella prima strofa si introduce il tema della foresta e della comunicazione, cioè delle melodie della foresta, come il vento tra gli alberi, che vengono cantate "senza trovar pace", senza tranquillità. La stessa cosa succede all\'uccellino della seconda strofa, che canta e sente solo la sua voce, evocando quindi un senso di solitudine, mentre dalla cima di un albero, scende verso la foce di un fiume, senza quiete (proprio perché canta). La terza strofa invece ritrova la pace e la tranquillità di una formica che ritorna al suo formicaio e che già pregusta la calma e il riposo che la dentro può trovare. Non a caso la formica, dato che le formiche non emettono suoni, e possono quindi rimanere tranquille.'
            },
            {
                id: 'il-viaggio-della-medusa',
                count_view: 0,
                title: 'Il viaggio della medusa',
                author: 'Davide',
                date: '2025-08-28',
                lines: [
                    'Ed ecco la medusa',
                    'che domani si sposa',
                    'ma la porta è chiusa',
                    'e muore la mimosa.',
                    '',
                    'In cerca di una scusa',
                    'in giornata afosa',
                    'riparte la medusa',
                    'triste e pensierosa.',
                    '',
                    'Tutto ciò che ha usa',
                    'per cercare qualcosa',
                    'che gli faccia da musa',
                    'nella vita noiosa'
                ],
                commentary: 'Scritta pensando ad un amore che non è corrisposto. La medusa si vuole sposare un domani, ma trova la porta chiusa, cioè il suo amore non è corrisposto, e muore la mimosa che ha portato dentro grazie alla felicità dell\'amore. Subita la delusione va in giro cercando di capire il perché (una scusa) non sia stata accettata, in una giornata afosa, cioè calda e soffocante. Superato l\'amore, rimane solo un vuoto, che deve essere colmato da qualcosa o qualcuno, e la medusa lo cerca senza sosta usando tutte le proprie risorse.'
            },
            {
                id: 'transizione-di-fase',
                count_view: 0,
                title: 'Transizione di Fase',
                author: 'Davide',
                date: '2025-08-31',
                lines: [
                    '"Attenti! Sta crollando"',
                    'urla il capitano',
                    'la cenere volando',
                    'è rotta la verità.',
                    '',
                    'Caduta è la Torre',
                    'in oceano di fiamme.',
                    'Ecco prega e corre',
                    'disperato si tuffò.',
                    '',
                    'In cerca di riparo',
                    'arriva a nuova riva',
                    'ora è tutto chiaro',
                    'Ecco l\'acqua sorgiva'
                ],
                commentary: 'La transizione di fase è quel processo per cui una sostanza passa da uno stato della materia ad un altro. In questo contesto indica il cambio di idee, la rottura delle certezze vecchie per formare verità nuove. La poesia è un continuo parallelismo tra un castello che cade durante una battaglia e un soldato che, perso il castello e trovandosi senza certezze, infine giunge a una nuova idea, ad una nuova tranquillità data da una nuova sorgente'
            },
            {
                id: 'il-giardino-dietro-casa',
                count_view: 0,
                title: 'Il giardino dietro casa',
                author: 'Davide',
                date: '2025-08-31',
                lines: [
                    'In giro per il mondo',
                    'tanti piccoli posti',
                    'io vado visitando:',
                    'calmi luoghi nascosti.',
                    '',
                    'Sulla strada un segno',
                    'di un vicino ignoto',
                    'di curiosità lo degno',
                    'ecco: scatto una foto.',
                    '',
                    'E dopo una vita',
                    'con chi mi sta intorno',
                    'vado per la salita:',
                    'vecchi legami formo.'
                ],
                commentary: 'Scritta ripensando a tutte le cose che ci stanno vicino, ma che non degnamo mai di uno sguardo. Questo finché non decidiamo di farci una passeggiata, e scoprire tante piccole cose che attirano la nostra curiosità, stupendoci molto più di quanto possa fare tutto il resto.'
            },
            {
                id: 'discorso-temporale',
                count_view: 0,
                title: 'Discorso temporale',
                author: 'Davide',
                date: '2025-09-07',
                lines: [
                    'Come parla il tempo',
                    'nessuno lo comprende',
                    'va avanti senza scampo:',
                    'eppure lo si vende.',
                    '',
                    'Neutre notizie porta',
                    'il ticchettio lento',
                    'che pure ci conforta',
                    'come un calmo vento.',
                    '',
                    'Nostalgia io sento',
                    'di lontano ricordo',
                    'e sentendo mi pento:',
                    'sento dolore sordo.',
                ],
                commentary: 'Questa poesia ha un significato più esplicito delle altre. Il tema principale è il tempo che passa e tutte le cose che porta (le parole che parla), come noi lo sprechiamo, la nostalgia e i rimpianti del passato.'
            },
            {
                id: 'spese-di-contesto',
                count_view: 0,
                title: 'Spese di contesto',
                author: 'Davide',
                date: '2025-09-09',
                lines: [
                    'Chi pagherà il costo',
                    'della vita coerente',
                    'del mio piccolo posto',
                    'trovato finalmente.',
                    '',
                    'Oscuro è il motivo',
                    'strana è la ragione',
                    'fa principio attivo',
                    'il contesto d\'azione.',
                    '',
                    'Il perché io agisco',
                    'sento nel fragore',
                    'del girevole disco',
                    'sul perpetuo rotore',
                ],
                commentary: 'A volte vogliamo aderire a determinati principi, diciamo di voler e voler fare cose per aderire a quei principi, ma ci pesa, all\'atto pratico, fare quelle cose: è questo il costo della coerenza. Allo stesso modo, il contesto ci influenza a credere e fare molte cose, ed anche questo è un costo che passiamo. I motivi però si trovano solo dentro di noi, scritti su quel disco, che è il cervello, che non si ferma mai.'
            },
            {
                id: 'continuo',
                count_view: 0,
                title: 'Continuo',
                author: 'Davide',
                date: '2025-09-09',
                lines: [
                    'In superficie arriva',
                    'un pensiero profondo',
                    'e vede sulla riva',
                    'uno strano nuovo mondo.',
                    '',
                    'Quanti pari mai visti',
                    'incontra sul cammino',
                    'vecchi, giovani, misti',
                    'ed esterni perfino.',
                    '',
                    'Ma come lui nessuno',
                    'che possa fare da re',
                    'si chinano uno ad uno',
                    'finché pace non c\'è.',
                    '',
                    'Un\'inaspettata voce',
                    'alzandosi veloce',
                    'il nuovo re uccide',
                    'tutti quanti deride.',
                    '',
                    'Finché piccolo nasce',
                    'un pensiero in fasce',
                    'dal mezzo egli proviene',
                    'un\'idea nuova sostiene.',
                    '',
                    'La pace egli riporta',
                    'lottando con ardore',
                    'il popolo conforta',
                    'che segue con furore.',
                    '',
                    'Un ultimo sguardo lancia',
                    'all\'ordine che ha posto',
                    'saziando la sua pancia',
                    'e pagando ogni costo.',
                    '',
                    '"Addio" infine dice',
                    'e torna al profondo',
                    'dove guarda felice',
                    'il continuo del mondo.'
                ],
                commentary: 'Lo scontro tra idee diverse è un processo grandioso e terribile, sopratutto quando riguarda quei principi profondi, radicati in noi, sui quali basiamo buona parte della conoscenza. Questo processo può attraversare varie fasi, da quella distruttiva dello scontro a quelle costruttive di messa in ordine e lotta per nuove idee. Infine il processo si conclude con nuovi pensieri che divengono la base della conoscenza, in attesa anche questi di subire lo stesso processo dei loro predecessori'
            }
        ];
        document.addEventListener('DOMContentLoaded', () => {

            // ========================================
            // THEME SWITCHER LOGIC
            // ========================================
            const themeToggle = document.getElementById('theme-toggle');
            const htmlEl = document.documentElement;

            const applyTheme = (theme) => {
                htmlEl.classList.toggle('dark-mode', theme === 'dark');
            };

            const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            applyTheme(savedTheme);

            themeToggle.addEventListener('click', () => {
                const isDarkMode = htmlEl.classList.contains('dark-mode');
                const newTheme = isDarkMode ? 'light' : 'dark';
                applyTheme(newTheme);
                localStorage.setItem('theme', newTheme);
            });


            // ========================================
            // MAIN APPLICATION LOGIC
            // ========================================
            const navLinks = document.querySelectorAll('.main-nav a');
            const contentSections = document.querySelectorAll('.content-viewer > section');
            const poemsToc = document.getElementById('poems-toc');
            const poemDisplayArea = document.getElementById('poem-display-area');
            const searchInput = document.getElementById('search-input');
            const logoLink = document.getElementById('logo-link');

            const welcomeMessageHTML = poemDisplayArea.innerHTML;
            
            // --- 1. Populate Table of Contents ---
            poems.sort((a, b) => new Date(a.date) - new Date(b.date)); // Sort poems by date, newest first
            poemsToc.innerHTML = poems.map(poem => `
                <li><a href="#${poem.id}" data-poem-id="${poem.id}">${poem.title}</a></li>
            `).join('');
            
            const tocLinks = poemsToc.querySelectorAll('a');

            // --- 2. Core Functions ---
            const displayPoem = (poemId) => {
                const poem = poems.find(p => p.id === poemId);
                if (!poem) return;

                poem.count_view++;

                const poemHTML = `
                    <article class="poem-display">
                        <h2>${poem.title}</h2>
                        <p class="poem-meta">Di ${poem.author} • ${new Date(poem.date).toLocaleDateString('it-IT', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <div class="poem-text">
                            ${poem.lines.map(line => `<div>${line || '&nbsp;'}</div>`).join('')}
                        </div>
                        ${(poem.commentary && poem.count_view >= 5) ? `
                        <div class="poem-commentary">
                            <h3>Commento</h3>
                            <p>${poem.commentary}</p>
                        </div>
                        ` : ''}
                    </article>
                `;
                poemDisplayArea.innerHTML = poemHTML;
                
                tocLinks.forEach(link => link.classList.toggle('active', link.dataset.poemId === poemId));
            };

            const switchView = (viewId) => {
                contentSections.forEach(section => section.classList.toggle('active', section.id === viewId));
                navLinks.forEach(link => link.classList.toggle('active', link.dataset.view === viewId));
            };

            // NEW: Function to reset the view to the default state
            const resetToHomeView = () => {
                switchView('poems-view');
                poemDisplayArea.innerHTML = welcomeMessageHTML;
                tocLinks.forEach(link => {
                    link.classList.remove('active');
                    link.parentElement.style.display = '';
                });
                searchInput.value = '';
                // Clean the URL hash without adding to history
                history.pushState("", document.title, window.location.pathname + window.location.search);
            };
            
            // --- 3. Event Listeners ---
            logoLink.addEventListener('click', (e) => {
                e.preventDefault();
                resetToHomeView();
            });

            document.querySelector('.main-nav').addEventListener('click', (e) => {
                if (e.target.tagName === 'A' && e.target.dataset.view) {
                    e.preventDefault();
                    switchView(e.target.dataset.view);
                }
            });
            
            poemsToc.addEventListener('click', (e) => {
                if (e.target.tagName === 'A' && e.target.dataset.poemId) {
                    e.preventDefault();
                    switchView('poems-view');
                    displayPoem(e.target.dataset.poemId);
                    window.location.hash = e.target.hash;
                }
            });

            // UPDATED: Search functionality to include poem text
            searchInput.addEventListener('input', (e) => {
                const searchTerm = e.target.value.toLowerCase();
                
                poems.forEach(poem => {
                    const title = poem.title.toLowerCase();
                    const content = poem.lines.join(' ').toLowerCase();
                    const isMatch = title.includes(searchTerm) || content.includes(searchTerm);
                    
                    const linkElement = poemsToc.querySelector(`[data-poem-id="${poem.id}"]`);
                    if (linkElement) {
                        linkElement.parentElement.style.display = isMatch ? '' : 'none';
                    }
                });
            });

            // --- 4. Handle Initial Page Load ---
            const currentHash = window.location.hash.substring(1);
            const poemLink = Array.from(tocLinks).find(link => link.hash === `#${currentHash}`);
            const navLink = Array.from(navLinks).find(link => link.dataset.view === currentHash);

            if (poemLink) {
                switchView('poems-view');
                displayPoem(poemLink.dataset.poemId);
            } else if (navLink) {
                switchView(navLink.dataset.view);
            } else {
                switchView('poems-view'); // Default view
            }
        });

    </script>
</body>
</html>